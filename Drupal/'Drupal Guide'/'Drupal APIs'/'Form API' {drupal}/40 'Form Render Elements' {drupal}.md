[](https://www.drupal.org/docs/drupal-apis/form-api/form-render-elements)[https://www.drupal.org/docs/drupal-apis/form-api/form-render-elements](https://www.drupal.org/docs/drupal-apis/form-api/form-render-elements)

Эта документация не завершена. [Add more information](https://www.drupal.org/node/2912673/edit).

# Form Elements

Элементы рендеринга форм - это подмножество элементов рендеринга, представляющих элементы для HTML форм, на которые можно ссылаться в форм-массивах.

Класс [Drupal\\Core\\Render\\Element\\FormElement](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Render%21Element%21FormElement.php/class/FormElement/8.7.x) предоставляет базовый класс для плагинов элементов формы.

Вот список пропертей, которые используются во время рендеринга и обработки элементов формы:

-   **#after\_build**: (массив) Массив имен вызываемых элементов или функций, которые вызываются после сборки элемента. Аргументы: $element, $form\_state.
-   **#ajax**: (массив) массив элементов для указания поведения Ajax. Дополнительную информацию см. в руководствах [Javascript API](https://www.drupal.org/docs/8/api/javascript-api) и [AJAX Forms](https://www.drupal.org/docs/8/api/javascript-api/ajax-forms).
-   **#array\_parents**: (string\[\], только для чтения) Массив имен всех родителей элемента (включая самого себя) в рендер-массиве. Смотрите также #parents, #tree.
-   **#default\_value**: Значение по умолчанию для элемента. См. также #value.
-   **#description**: (строка) Текст справки или описания для элемента. В идеальном пользовательском интерфейсе #title должен быть достаточным для описания элемента, поэтому большинство элементов не должны иметь описания; если он вам нужен, убедитесь, что он переведен. Если он еще не обернут в безопасный объект разметки, он будет отфильтрован для защиты от XSS.
-   **#description\_display:** (string) Где и как отобразить #description. Возможные значения:
    -   after: Описание идет после элемента (по умолчанию).
    -   before: Описание идет после элемента.
    -   invisible: Описание есть, но сделано невидимым с помощью CSS.
-   **#disabled**: (bool) Если TRUE, то элемент отображается, но не принимает ввод пользователя.
-   **#element\_validate**: (массив) Массив вызываемых элементов или имен функций, которые вызываются для проверки входных данных. Аргументы: $element, $form\_state, $form.
-   **#prefix**: (строка) Префикс для отображения перед HTML элементом ввода. Должен быть переведен, как правило. Если он еще не обернут в безопасный объект разметки, будет отфильтрован для защиты от XSS атак.
-   **#suffix**: (строка) Суффикс для отображения после HTML элемента ввода. Должен быть переведен, как правило. Если он еще не обернут в объект безопасной разметки, будет отфильтрован для защиты от XSS атак.
-   **#input**: (bool, внутренний) Принимает ли элемент ввода.
-   **#parents**: (string\[\], только для чтения) Массив имён родителей элемента для получения значений из $form\_state. См. также #array\_parents, #tree.
-   **#process**: (массив) Массив имен вызываемых элементов или функций, которые вызываются при построении формы. Аргументы: $element, $form\_state, $form.
-   **#processed**: (bool, внутренний) Устанавливается в TRUE при обработке элемента.
-   **#required**: (bool) Требуется ли ввод данных для элемента или нет.
-   **#required\_error**: (string) Будет использовано переопределение сообщения об ошибке по умолчанию "@field\_title is required", если оно не определено.
-   **#states**: (массив) Информация о состоянии JavaScript, например, когда скрывать или показывать элемент на основе ввода на других элементах. Смотрите документацию [drupal\_process\_states()](https://api.drupal.org/api/drupal/core%21includes%21common.inc/function/drupal_process_states).
-   **#title**: (string) Название элемента формы. Должно быть переведено.
-   **#title\_display**: (string) Где и как отображать #title. Возможные значения:
    -   before: Метка идет перед элементом (по умолчанию для большинства элементов).
    -   after: Метка идет после элемента (по умолчанию для радио элементов).
    -   invisible: Метка есть, но сделана невидимой с помощью CSS.
    -   attribute: Сделать его атрибутом title (всплывающая подсказка).
-   **#tree**: (bool) TRUE, если значения этого элемента и его дочерних элементов должны быть иерархическими в $form\_state; FALSE, если значения должны быть плоскими. См. также #parents, #array\_parents.
-   **#value\_callback**: (вызываемое) callable или имя функции, которая вызывается для преобразования необработанного пользовательского ввода в значение элемента. Аргументы: $element, $input, $form\_state.

# HTML5 Form Render Elements

HTML5 элементы это:

-   `'#type' => 'tel'` (см. [Tel](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Render%21Element%21Tel.php/class/Tel/8.8.x))
-   `'#type' => 'email'` (см. [Email](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Render%21Element%21Email.php/class/Email/8.8.x))
-   `'#type' => 'number'` (см. [Number](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Render%21Element%21Number.php/class/Number/8.8.x))
-   `'#type' => 'date'`
-   `'#type' => 'url'`
-   `'#type' => 'search'`
-   `'#type' => 'range'`

Использование этих элементов, в отличие от запроса данных через обычные текстовые поля, предпочтительнее, так как устройства могут подбирать для них подходящие методы ввода, например, когда запрашивается телефонный номер, на устройстве будет отображаться экран клавиатуры.

# Другие полезные рендер-элементы

-   **details**: Элемент `'#type' => 'details'` является группирующим элементом с обобщением.
-   **language\_select**: Элемент `'#type' => 'language_select'` является элементом выбора языка, чтобы облегчить настройку языка на формах.
-   **dropbutton**: Элемент `'#type' => 'dropbutton'` предоставляет общий список выбора с помощью кнопки с выпадающим списком. См. также элемент `'#type' => 'operations'`.
-   **operations**: Элемент `'#type' => 'operations'` предоставляет список доступных операций, которые обычно можно найти в административных экранах конфигурации сущностей, таких как _admin/structure/types_.
-   **Другие сущности с автозавершением:** Элемент \`'#type'' => 'entity\_autocomplete' позволяет выбрать сущность определенного типа.

См. [namespace Drupal\\Core\\Render\\Element](https://api.drupal.org/api/drupal/namespace/Drupal%21Core%21Render%21Element/8) для информации о всех предоставляемых ядром элементах.

# Изменение или добавление элементов формы

В этой главе рассказывается о добавлении новых полей или изменении существующих полей на формах, которые были созданы ядром Drupal или любым другим модулем. Если вы ищете информацию о [создании новых форм в вашем пользовательском модуле Drupal](https://www.drupal.org/docs/8/api/form-api/introduction-to-form-api), смотрите Руководство [Введение в API формы](https://www.drupal.org/docs/8/api/form-api/introduction-to-form-api), которое предоставляет основной пример создания форм, с которого вы можете начать.

Независимо от того, хотите ли вы изменить существующие поля или добавить новые в существующую форму, вам придется реализовать [hook\_form\_alter](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Form%21form.api.php/function/hook_form_alter/8.5.x) или [hook\_form\_FORM\_ID\_alter](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Form%21form.api.php/function/hook_form_FORM_ID_alter/8.2.x).

Внутри хука вы должны сначала выяснить, какой ID использует ваша форма. hook\_form\_alter предоставляет $form\_id в качестве параметра. Начните с создания модуля и добавьте хук (см. пример ниже). Если вы используете отладчик, просто установите там точку останова и проверьте $form\_id.

Если у вас нет отладчика, убедитесь, что модули devel и kint установлены и включены, и поместите вызов функции kint($form\_id) в верхнюю часть хук-функции. Перезагрузите страницу, показывающую вашу форму и проверьте вывод kint на наличие идентификатора формы.

## \= Пример изменения существующих полей формы

```php
/**
 * Implements hook_form_alter.
 *
 * Alters the display of a form
 */
function mymodule_form_alter(&$form, FormStateInterface $form_state, $form_id)
{
    // получение id формы которую вы хотите изменить
    //kint($form_id);

    // изменение формы редактирования вашего кастомого контент-типа
    if($form_id == 'node_yourcontenttype_edit_form') {
        // посмотреть форм-массив, который помимо прочего 
        // показывает доступные поля
        //kint($form);

        // скрытие настройки ревизии формы
        $form['revision_information']['#access'] = false;
        
        // делаем поле формы только-для-чтения
	      $form['field_summe']['widget'][0]['value']['#attributes']['readonly'] = true;

        // изменение описания поля с телефонным номером
        $form['phone_number']['#description'] = t('Start with + and your country code.');

        // прикрепление вашей кастомной библиотеки к формам
        // эту библиотеку вам будет нужно определить в файле модуля mymodule.libraries.yml
        $form['#attached']['library'][] = 'mymodule/mylibrary';                
    }

}
```

## \= Пример добавления в форму нового поля

```php
/**
 * Implements hook_form_alter.
 *
 * Alters the display of a form
 */
function mymodule_form_alter(&$form, FormStateInterface $form_state, $form_id)
{
    // получаем id формы которую мы хотим изменить
    //kint($form_id);

    // изменяем форму редактирования нашего кастомного контент-типа
    if($form_id == 'node_yourcontenttype_edit_form') {
        // смотрим форм-массив, который помимо прочего содержит доступные поля
        //kint($form);

        // Добавление некоторой кастомной разметы в вашу фаорму.
        // Базово мы можем добавить любые поля здесь. Но если мы хотим сохранять их значение
        // мы должны убедиться что мы обрабатываем введенное значение в нашем обработчике отправки формы
        $markup = '<div id="my-custom-markup"><h1>Here is my markup</h1></div>';
        $form['field_mycustommarkup'] = [
            '#type' => 'markup',
            '#markup' => $markup,
            // используем #weight чтобы двигать это поле вверх/вниз в нашей форме
            // проверьте какой вес у других элементов чтобы понять какой вес использовать
            '#weight' => 1,            
        ];

        // Допустим эта форма имеет некоторые группы полей, или группы табов
        // Мы хотим поместить кастомную разметку внутрь этих групп
        
        // Получаем список всех групп текущей формы и их детей
        //kint($form['#group_children'])

        // Допустим наша группа называется group_someoptions и мы хотим поместить кастомную разметку внутрь этой группы
        $form['#group_children']['field_mycustommarkup'] = 'group_someoptions';
    }
}
```

{ - done - 2021-02-18 }